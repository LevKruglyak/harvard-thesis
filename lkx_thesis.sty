% Common math packages 
\usepackage{amsfonts}
\usepackage{mathtools}
\usepackage{mathrsfs}
\usepackage{cancel}
% \usepackage{extpfeil} % Arrows

% Math symbol hacks
\makeatletter
\newcommand{\raisemath}[1]{\mathpalette{\raisem@th{#1}}}
\newcommand{\raisem@th}[3]{\raisebox{#1}{$#2#3$}}
\makeatother

% Global settings for math environments
\renewcommand{\arraystretch}{1.25}

% TikZ
\usepackage{tikz}
\usepackage{tikz-cd}
\usetikzlibrary{positioning}

% Debug
\newcommand{\todo}[1]{{\color{red}{#1}}}

% Epigraph
\NewDocumentEnvironment{epigraph}{m m}
{\begin{flushleft}\slshape}{
		\normalfont\par\rule[0pt]{#1}{0.5pt}\\
		-- \textsc{#2}
		\vspace{2em}
	\end{flushleft}}

% Math environments
\NewDocumentCommand{\defn}{m o}{%
	{\color{blue}{\textnormal{\emph{#1}}}}%
	\IfValueTF{#2}{\index{#2}}{\index{#1}}}%

% Math commands
\renewcommand{\binom}[2]{
	\Bigl(\,\begin{array}{@{}c@{}}#1\\#2\end{array}\,\Bigr)}
\renewcommand{\cong}{\approx}

\providecommand{\+}{\,\#\,} % Connected sum

\providecommand{\Z}{\mathbb{Z}}
\providecommand{\Q}{\mathbb{Q}}
\providecommand{\R}{\mathbb{R}}
\providecommand{\N}{\mathbb{N}}
\providecommand{\C}{\mathbb{C}}
\providecommand{\HH}{\mathbb{H}}
\providecommand{\OO}{\mathbb{O}}
\providecommand{\CP}{\mathbb{CP}}
\providecommand{\RP}{\mathbb{RP}}
\providecommand{\HP}{\mathbb{HP}}
\providecommand{\OP}{\mathbb{OP}}

\undef\H
\undef\T
\undef\span
\undef\gcd

\DeclareMathOperator{\H}{H} % (co)homology
\DeclareMathOperator{\T}{T\!} % tangent space
\DeclareMathOperator{\span}{span}
\DeclareMathOperator{\rank}{rank}
\DeclareMathOperator{\lcm}{lcm}
\DeclareMathOperator{\gcd}{gcd}
\DeclareMathOperator{\End}{End}
\DeclareMathOperator{\Hom}{Hom}
\DeclareMathOperator{\Ann}{Ann}
\DeclareMathOperator{\Aut}{Aut}
\DeclareMathOperator{\Tor}{Tor}
\DeclareMathOperator{\Ext}{Ext}
\DeclareMathOperator{\Spec}{Spec}
\DeclareMathOperator{\Diff}{Diff}

\providecommand{\GL}{\mathrm{SO}}
\providecommand{\Sp}{\mathrm{Sp}}
\providecommand{\U}{\mathrm{U}}
\providecommand{\O}{\mathrm{O}}
\providecommand{\SU}{\mathrm{SU}}
\providecommand{\SO}{\mathrm{SO}}
\providecommand{\SL}{\mathrm{SL}}
\providecommand{\Spin}{\mathrm{Spin}}

\providecommand{\MSO}{\mathrm{MSO}}
\providecommand{\BSO}{\mathrm{BSO}}

% Categories
\providecommand{\cat}[1]{\mathsf{#1}}

\newcommand{\DIFF}{\cat{DIFF}}
\newcommand{\PL}{\cat{PL}}
\newcommand{\TOP}{\cat{TOP}}

% Cobordism
\DeclareRobustCommand{\bord}{\!
	\mathrel{\vcenter{\hbox{
				\begin{tikzpicture}[baseline=(b.base)]
					\begin{scope}[line width=0.6pt]
						\node (b) at (1.0ex,-0.9ex) {};
						\draw (0,-0.2ex) ellipse (0.15ex and 0.4ex);
						\begin{scope}
							\clip (1.2ex,-1ex) rectangle (1.7ex,0.6ex);
							\draw (1.2ex,-0.2ex) ellipse (0.15ex and 0.4ex);
						\end{scope}
						\draw (0,-0.6ex) -- (1.2ex, -0.6ex);
						\draw (0,0.2ex) -- (1.2ex, 0.2ex);
						\draw[line cap=round] (-0.15ex,-1ex) -- (1.35ex, -1ex);
					\end{scope}
				\end{tikzpicture}}}}}

% Bordism variants
\newcommand{\hbord}{\bord_{\!\raisemath{3pt}{h}}}
\newcommand{\sobord}{\bord^{\mkern-2mu\mathrm{so}}}
\newcommand{\sohbord}{\hbord^{\mkern-2mu\mathrm{so}}}
\newcommand{\spinbord}{\bord^{\mkern-2mu\mathrm{spin}}}

\newcommand{\fr}{\mathrm{fr}}
\newcommand{\frbord}{\bord^{\mkern-2mu\fr}}

% Arrows 
\ExplSyntaxOn
\NewDocumentCommand{\lkxiff}{ O{} }{
	\mathrel{\;\xleftrightarrow{\hphantom{xx}#1\hphantom{xx}}\;}
}
\NewDocumentCommand{\lkxto}{ O{} }{
	\mathrel{\;\xrightarrow{\hphantom{xx}#1\hphantom{xx}}\;}
}
\NewDocumentCommand{\lkxmapsto}{ O{} }{
	\mathrel{\;\xmapsto{\hphantom{xx}#1\hphantom{xx}}\;}
}
\NewDocumentCommand{\lkxisom}{ O{} }{
	\mathrel{\;\xrightarrow{\hphantom{xx}#1\sim\hphantom{xx}}\;}
}
\NewDocumentCommand{\lkxsurj}{ O{} }{
	\mathrel{\;\xrightarrow{\hphantom{xx}#1\hphantom{xx}}\!\!\!\!\!\xrightarrow\;}
}

\NewDocumentCommand{\lkxfunc}{ O{->} m m m g g }{
	\begin{array}{rcl}
		\IfNoValueTF {#5} {
		\tl_if_blank:nTF {#2}{}{#2 :}
		#3
		\str_case:nn {#1}
		{
			{->} {\lkxto}
				{~>} {\lkxisom}
				{->>} {\lkxsurj}
		}
		#4
		} {
		\tl_if_blank:nTF {#2}{}{#2 \;:\;}
		{#3}
		     &
		\str_case:nn {#1}
		{
			{->} {\lkxto}
				{~>} {\lkxisom}
				{->>} {\lkxsurj}
		}
		     & {#4}
		\\
		{#5} & \lkxmapsto & {#6}
		}
	\end{array}
}

\ExplSyntaxOff
