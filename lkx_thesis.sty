% Common math packages 
\usepackage{amsfonts}
\usepackage{mathtools}
\usepackage{mathrsfs}
\usepackage{cancel}
% \usepackage{extpfeil} % Arrows

% Math symbol hacks
\makeatletter
\newcommand{\raisemath}[1]{\mathpalette{\raisem@th{#1}}}
\newcommand{\raisem@th}[3]{\raisebox{#1}{$#2#3$}}
\makeatother

% Global settings for math environments
\AtBeginEnvironment{tabular}{\renewcommand{\arraystretch}{1.25}} 

% TikZ
\usepackage{tikz}
\usepackage{tikz-cd}
\usetikzlibrary{positioning}
\usetikzlibrary{calc}
\usetikzlibrary{decorations.pathmorphing}
\usetikzlibrary{arrows}
\usetikzlibrary{arrows.meta}

\tikzset{curve/.style={settings={#1},to path={(\tikztostart)
    .. controls ($(\tikztostart)!\pv{pos}!(\tikztotarget)!\pv{height}!270:(\tikztotarget)$)
    and ($(\tikztostart)!1-\pv{pos}!(\tikztotarget)!\pv{height}!270:(\tikztotarget)$)
    .. (\tikztotarget)\tikztonodes}},
    settings/.code={\tikzset{quiver/.cd,#1}
        \def\pv##1{\pgfkeysvalueof{/tikz/quiver/##1}}},
    quiver/.cd,pos/.initial=0.35,height/.initial=0}

\tikzcdset{every arrow/.append style={line width=0.8pt}}
\tikzcdset{every arrow/.append style = -{Computer Modern Rightarrow[width=6.7pt,length=3pt]}}
\tikzcdset{leftrightarrow/.append style= {Computer Modern Rightarrow[width=6.7pt, length=3pt]}-{Computer Modern Rightarrow[width=6.7pt, length=3pt]}}

% Debug
\newcommand{\todo}[1]{{\color{red}{#1}}}

% Epigraph
\NewDocumentEnvironment{epigraph}{m m}
{\begin{flushleft}\slshape}{
		\par\normalfont\rule[0pt]{#1}{0.5pt}\\
		-- \textsc{#2}
		\vspace{2em}
	\end{flushleft}}

% Math environments
\NewDocumentCommand{\defn}{m o}{%
	{\color{blue}{\textnormal{\emph{#1}}}}%
	\IfValueTF{#2}{\index{#2}}{\index{#1}}}%

% Math commands
\renewcommand{\binom}[2]{
	\Bigl(\,\begin{array}{@{}c@{}}#1\\#2\end{array}\,\Bigr)}
	\let\oldcong\cong
\renewcommand{\cong}{\approx}
\renewcommand{\epsilon}{\varepsilon}
\NewDocumentCommand{\+}{o}{
	\IfValueTF{#1}{\raisemath{1pt}{\#^{#1}}}{\,\#\,}
}

\undef\P

\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\C}{\mathbb{C}}
\newcommand{\P}{\mathbb{P}}
\newcommand{\F}{\mathbb{F}}
\newcommand{\FP}{\mathbb{FP}}
\newcommand{\HH}{\mathbb{H}}
\newcommand{\CP}{\mathbb{CP}}
\newcommand{\RP}{\mathbb{RP}}
\newcommand{\HP}{\mathbb{HP}}
\newcommand{\OP}{\mathbb{OP}}
\newcommand{\EE}{\mathrm{E}}

\newcommand{\BB}{\mathrm{B}}
\newcommand{\BBB}{\mathcal{B}}

\newcommand{\Class}{\mathsf{CC}}
\newcommand{\fps}[1]{[\![#1]\!]}

\newcommand{\cl}{\mathrm{c}}

\undef\H
\undef\T
\undef\span
\undef\gcd
\undef\ker
\undef\O
\undef\Vert
\undef\Re
\undef\Im

\newcommand{\HdR}{\H_{\mathrm{dR}}} % de Rham cohomology
\newcommand{\Hc}{\H_{\mathrm{c}}} % de Rham homology

\DeclareMathOperator{\Re}{Re}
\DeclareMathOperator{\Im}{Im}

\DeclareMathOperator{\X}{\mathfrak{X}} % vector field
\DeclareMathOperator{\H}{H} % (co)homology
\newcommand{\Hr}{\widetilde{\H}} % reduced homology
\DeclareMathOperator{\span}{span}
\DeclareMathOperator{\rank}{rank}
\DeclareMathOperator{\ker}{ker}
\DeclareMathOperator{\coker}{coker}
\DeclareMathOperator{\denom}{denom}
\DeclareMathOperator{\numer}{num}
\DeclareMathOperator{\lcm}{lcm}
\DeclareMathOperator{\gcd}{gcd}
\DeclareMathOperator{\End}{End}
\DeclareMathOperator{\Hom}{Hom}
\DeclareMathOperator{\Ann}{Ann}
\DeclareMathOperator{\Aut}{Aut}
\DeclareMathOperator{\Tor}{Tor}
\DeclareMathOperator{\Ext}{Ext}
\DeclareMathOperator{\Spec}{Spec}
\DeclareMathOperator{\Diff}{Diff}
\DeclareMathOperator{\Vect}{Vect}
\DeclareMathOperator{\Vert}{Vert}
\DeclareMathOperator{\Edge}{Edge}
\DeclareMathOperator{\Bun}{Bun}
\DeclareMathOperator{\Int}{Int}
\DeclareMathOperator{\Nat}{Nat}
\DeclareMathOperator{\Sq}{Sq}
\DeclareMathOperator{\Fl}{Fl}
\DeclareMathOperator{\Fr}{Fr}

\newcommand{\EU}{\mathcal{E}\mathrm{U}}

\renewcommand{\d}{*} % dual space
\newcommand{\plumb}{\boxplus}

\newcommand{\T}{\mathrm{T}} % tangent space
\newcommand{\NNM}{\mathcal{N}} % normal space 
\newcommand{\NM}{\mathrm{N}} % normal bundle 
\newcommand{\TT}{{\mathcal{T}\hspace{-0.1em}}} % tangent space total bundle
\newcommand{\B}{\mathscr{B}} % frame bundle
\newcommand{\OO}{\mathcal{O}} % frame bundle

\renewcommand{\S}{{S}} % sphere bundle
\newcommand{\D}{{D}} % disk bundle

\newcommand{\id}{\mathrm{id}}

\newcommand{\GL}{\mathrm{GL}}
\newcommand{\Sp}{\mathrm{Sp}}
\newcommand{\U}{\mathrm{U}}
\newcommand{\E}{\mathrm{E}}
\newcommand{\O}{\mathrm{O}}
\newcommand{\SU}{\mathrm{SU}}
\newcommand{\SO}{\mathrm{SO}}
\newcommand{\SL}{\mathrm{SL}}
\newcommand{\Spin}{\mathrm{Spin}}
\newcommand{\Gr}{\mathrm{Gr}}

\newcommand{\MO}{\mathrm{MO}}
\newcommand{\MSO}{\mathrm{MSO}}

\newcommand{\BO}{\mathrm{BO}}
\newcommand{\BSO}{\mathrm{BSO}}
\newcommand{\BU}{\mathrm{BU}}

% Special Symbols
\newcommand{\Ahat}{\widehat{A}}
\newcommand{\tnsv}{\cdot}

% Exotic Sphere Symbols
\newcommand{\bP}{bP}
\newcommand{\milinv}{\lambda_{\mathrm{mil}}}
\newcommand{\ekinv}{\lambda_{\mathrm{e,k}}}
\newcommand{\gmsp}{\Sigma^7_{\mathrm{gm}}}

% Categories
\newcommand{\cat}[1]{\mathsf{#1}}
\newcommand{\Set}{\cat{Set}}
\newcommand{\Rng}{\cat{Rng}}
\newcommand{\Top}{\cat{Top}}
\newcommand{\hTop}{\cat{hTop}}
\newcommand{\Grp}{\cat{Grp}}
\newcommand{\AbGrp}{\cat{AbGrp}}
\newcommand{\Man}{\cat{Man}}

\newcommand{\DIFF}{\cat{DIFF}}
\newcommand{\PL}{\cat{PL}}
\newcommand{\TOP}{\cat{TOP}}

% Cobordism
\DeclareRobustCommand{\bord}{\!
	\mathrel{\vcenter{\hbox{
				\begin{tikzpicture}[baseline=(b.base)]
					\begin{scope}[line width=0.6pt]
						\node (b) at (1.0ex,-0.9ex) {};
						\draw (0,-0.2ex) ellipse (0.15ex and 0.4ex);
						\begin{scope}
							\clip (1.2ex,-1ex) rectangle (1.7ex,0.6ex);
							\draw (1.2ex,-0.2ex) ellipse (0.15ex and 0.4ex);
						\end{scope}
						\draw (0,-0.6ex) -- (1.2ex, -0.6ex);
						\draw (0,0.2ex) -- (1.2ex, 0.2ex);
						\draw[line cap=round] (-0.15ex,-1ex) -- (1.35ex, -1ex);
					\end{scope}
				\end{tikzpicture}}}}}

% Bordism variants
\newcommand{\hbord}{\bord_{\!\raisemath{3pt}{h}}}
\newcommand{\sobord}{\bord^{\mkern-2mu\mathrm{so}}}
\newcommand{\sohbord}{\hbord^{\mkern-2mu\mathrm{so}}}
\newcommand{\spinbord}{\bord^{\mkern-2mu\mathrm{spin}}}

\newcommand{\fr}{\mathrm{fr}}
\newcommand{\frbord}{\bord^{\mkern-2mu\fr}}

% Arrows 
\ExplSyntaxOn
\NewDocumentCommand{\lkxiff}{ O{} }{
	\mathrel{\;\xleftrightarrow{\hphantom{xx}#1\hphantom{xx}}\;}
}
\NewDocumentCommand{\lkxto}{ O{} }{
	\mathrel{\;\xrightarrow{\hphantom{xx}#1\hphantom{xx}}\;}
}
\NewDocumentCommand{\lkxleftrightto}{ O{} }{
	\mathrel{\;\xleftrightarrow{\hphantom{xx}#1\hphantom{xx}}\;}
}
\NewDocumentCommand{\lkxhookto}{ O{} }{
	\mathrel{\;\xhookrightarrow{\hphantom{xx}#1\hphantom{xx}}\;}
}
\NewDocumentCommand{\lkxmapsto}{ O{} }{
	\mathrel{\;\xmapsto{\hphantom{xx}#1\hphantom{xx}}\;}
}
\NewDocumentCommand{\lkxisom}{ O{} }{
	\mathrel{\;\xrightarrow{\hphantom{xx}#1\sim\hphantom{xx}}\;}
}
\NewDocumentCommand{\lkxsurj}{ O{} }{
	\mathrel{\;\xrightarrow{\hphantom{xx}#1\hphantom{xx}}\!\!\!\!\!\xrightarrow\;\;}
}

\NewDocumentCommand{\lkxfunc}{ O{->} m m m g g }{
	\begin{array}{rcl}
		\IfNoValueTF {#5} {
		\tl_if_blank:nTF {#2}{}{#2 :}
		#3
		\str_case:nn {#1}
		{
			{->} {\lkxto}
				{~>} {\lkxisom}
				{->>} {\lkxsurj}
		}
		#4
		} {
		\tl_if_blank:nTF {#2}{}{#2 \;:\;}
		{#3}
		     &
		\str_case:nn {#1}
		{
			{->} {\lkxto}
				{~>} {\lkxisom}
				{->>} {\lkxsurj}
		}
		     & {#4}
		\\
		{#5} & \lkxmapsto & {#6}
		}
	\end{array}
}

\ExplSyntaxOff
