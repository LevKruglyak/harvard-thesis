\usepackage{xcolor}
\usepackage{xstring}
\usepackage{xparse}
\usepackage{graphicx}

% For debugging
\usepackage{lipsum}

% Epigraphs
\usepackage{cjhebrew}

% -----------------------------------------------
%              Index 
% -----------------------------------------------
\usepackage{imakeidx}
\makeindex[intoc]
\newcommand{\lkxindex}{\printindex}

% -----------------------------------------------
%              Basic math stuff
% -----------------------------------------------

\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{mathtools}
\usepackage{amsthm}
\usepackage{amssymb} % Standard ams libraries
\usepackage{bm} % Bold math
\usepackage{mathrsfs}
\usepackage{cancel}

% -----------------------------------------------
%              Page Style 
% -----------------------------------------------
\usepackage[twoside]{fancyhdr}
\def\afterpreface{\newpage
	\pagestyle{fancy}}
\pagestyle{fancy}
% \fancyhead[C]{\rule{.5\textwidth}{4\baselineskip}}
\setlength{\headheight}{0.5in}
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}
\fancyhf[leh,roh]{\thepage}
\fancyhf[loh,reh]{\slshape\leftmark}

\usepackage[skip=0em, indent=2em]{parskip}

% -----------------------------------------------
%              References
% -----------------------------------------------
\usepackage[style=numeric, natbib=true, backref=true, backrefstyle=three]{biblatex}
\bibliography{thesis}{}

\newcommand{\lkxrefs}{
	\renewcommand\bibname{References}
	\printbibliography
	\addcontentsline{toc}{chapter}{References}
}

\usepackage{hyperref}
\usepackage[capitalize,nameinlink,noabbrev]{cleveref}

\hypersetup{
	colorlinks=true,
	linkcolor=blue,
	citecolor=green!50!black,
	filecolor=gray,
	urlcolor=red!50!black
}

\renewcommand{\chapterautorefname}{Chapter}
\renewcommand{\sectionautorefname}{Section}
\renewcommand{\subsectionautorefname}{Section}

% -----------------------------------------------
%              Table of Contents
% -----------------------------------------------
\newcommand{\lkxtoc}{
	\setcounter{tocdepth}{1}
	\tableofcontents
}

% -----------------------------------------------
%              Environments
% -----------------------------------------------

\newenvironment{changemargins}{%
\begin{list}{}{%
		\setlength{\itemsep}{0em}
		\setlength{\topsep}{0em}%
		\setlength{\leftmargin}{1em}%
		\setlength{\rightmargin}{1em}%
		\setlength{\listparindent}{\parindent}%
		\setlength{\itemindent}{\parindent}%
		\setlength{\parsep}{\parskip}%
	}%
	\item\leavevmode\vspace{-1.5em}
	      }{
\end{list}
{\medskip}
}

\NewDocumentCommand{\defn}{m o}{%
	\textbf{\textsl{#1}}%
	\IfValueTF{#2}{\index{#2}}{\index{#1}}%
}

\NewDocumentCommand{\keyword}{m o}{%
	\emph{#1}%
	\IfValueTF{#2}{\index{#2}}{\index{#1}}%
}

\newcommand{\todo}[1]{{\color{red}\textbf{#1}}}

\newtheoremstyle{lkx_theorem}
{}{}{\slshape}{}{}{.}{ }
{{\textbf{\thmname{#1}\thmnumber{ #2}}}\thmnote{ (\textsc{#3}\index{#3 (Theorem)})}}

\theoremstyle{lkx_theorem}
\newtheorem{theorem}{Theorem}[]
\renewcommand{\theoremautorefname}{Theorem}

\newtheorem{claim}[theorem]{Claim}
\newcommand{\claimautorefname}{Claim}

\newtheorem{lemma}[theorem]{Lemma}
\newcommand{\lemmaautorefname}{Lemma}

\newtheorem{conjecture}[theorem]{Conjecture}
\newcommand{\conjectureautorefname}{Conjecture}

\newtheorem{corollary}[theorem]{Corollary}
\newcommand{\corollaryautorefname}{Corollary}

\newtheorem{proposition}[theorem]{Proposition}
\newcommand{\propositionautorefname}{Proposition}

\newtheorem{insight}{Insight}
\newcommand{\insightautorefname}{Insight}

\newtheoremstyle{lkx_definition}
{}{}{\slshape}{}{}{.}{ }
{{\bfseries\thmname{#1}\thmnumber{ #2}}\thmnote{ (#3\index{#3})}}

\theoremstyle{lkx_definition}
\newtheorem{definition}[theorem]{Definition}
\newcommand{\definitionautorefname}{Definition}

\newtheorem{remark}[theorem]{Remark}
\newcommand{\remarkautorename}{Remark}

\newtheorem{example}[theorem]{Example}
\newcommand{\exampleautorename}{Example}

\newtheorem*{definition*}{Definition}
\newtheorem*{theorem*}{Theorem}
\newtheorem*{remark*}{Remark}
\newtheorem*{proposition*}{Proposition}
\newtheorem*{claim*}{Claim}
\newtheorem*{lemma*}{Lemma}
\newtheorem*{example*}{Example}
\newtheorem*{corollary*}{Corollary}
\newtheorem*{conjecture*}{Conjecture}

\renewcommand{\qed}{\hfill$\blacksquare$}

% -----------------------------------------------
%              Common Math
% -----------------------------------------------

% Common number systems
\providecommand{\Z}{\mathbb{Z}}
\providecommand{\Q}{\mathbb{Q}}
\providecommand{\R}{\mathbb{R}}
\providecommand{\N}{\mathbb{N}}
\providecommand{\C}{\mathbb{C}}
\providecommand{\HH}{\mathbb{H}}
\providecommand{\F}{\mathbb{F}}

% Projective spaces
\providecommand{\CP}{\mathbb{CP}}
\providecommand{\RP}{\mathbb{RP}}

% Algebraic structures and operators
\providecommand{\lcm}{\operatorname{lcm}}
\providecommand{\gcd}{\operatorname{gcd}}
\providecommand{\End}{\operatorname{End}}
\providecommand{\Hom}{\operatorname{Hom}}
\providecommand{\Ann}{\operatorname{Ann}}
\providecommand{\Aut}{\operatorname{Aut}}
\providecommand{\Tor}{\operatorname{Tor}}
\providecommand{\Ext}{\operatorname{Ext}}
\providecommand{\Spec}{\operatorname{Spec}}
\providecommand{\Proj}{\operatorname{Proj}}
\renewcommand{\H}{\operatorname{H}}

% Lie groups and algebras
\providecommand{\liegrp}[1]{{\operatorname{#1}}}
\providecommand{\liealg}[1]{\mathfrak{#1}}

\providecommand{\Gr}{\liegrp{Gr}}
\providecommand{\GL}{\liegrp{GL}}
\providecommand{\SL}{\liegrp{SL}}
\providecommand{\SO}{\liegrp{SO}}
\providecommand{\O}{\liegrp{O}}
\providecommand{\SU}{\liegrp{SU}}
\providecommand{\U}{\liegrp{U}}
\providecommand{\E}{\liegrp{E}}
\providecommand{\Sp}{\liegrp{Sp}}
\providecommand{\BGL}{\liegrp{BGL}}
\providecommand{\BSL}{\liegrp{BSL}}
\providecommand{\BSO}{\liegrp{BSO}}
\providecommand{\BO}{\liegrp{BO}}
\providecommand{\BSU}{\liegrp{BSU}}
\providecommand{\BU}{\liegrp{BU}}
\providecommand{\BSp}{\liegrp{BSp}}
\providecommand{\g}{\liealg{g}}
\providecommand{\gl}{\liealg{gl}}
\providecommand{\sl}{\liealg{sl}}
\providecommand{\h}{\liealg{h}}
\providecommand{\n}{\liealg{n}}

\providecommand{\Lie}{\operatorname{Lie}}

% Category Theory
\providecommand{\cat}[1]{\mathtt{#1}}
\providecommand{\Set}{\cat{Set}}
\providecommand{\Top}{\cat{Top}}
\providecommand{\hTop}{\cat{hTop}}
\providecommand{\TopMan}{\cat{TMan}}
\providecommand{\SMan}{\cat{SMan}}
\providecommand{\PLMan}{\cat{PLMan}}

% Misc
\providecommand{\op}{\operatorname}
\providecommand{\coker}{\operatorname{coker}}
\providecommand{\id}{\op{id}}
\providecommand{\geq}{\geqslant}
\providecommand{\leq}{\leqslant}
\providecommand{\rank}{\operatorname{rank}}
\providecommand{\Map}{\op{Map}}

% Cobordism
\newcommand{\cylinderequals}{
	\begin{tikzpicture}
		\begin{scope}[line width=0.6pt]
			\draw (0,-0.2ex) ellipse (0.15ex and 0.4ex);
			\begin{scope}
				\clip (1.2ex,-1ex) rectangle (1.7ex,0.6ex);
				\draw (1.2ex,-0.2ex) ellipse (0.15ex and 0.4ex);
			\end{scope}
			\draw (0,-0.6ex) -- (1.2ex, -0.6ex);
			\draw (0,0.2ex) -- (1.2ex, 0.2ex);

			\draw[line cap=round] (-0.15ex,-1ex) -- (1.35ex, -1ex);
			% \draw (0,-0.2ex) ellipse (0.3ex and 0.7ex);
			% \begin{scope}
			% 	\clip (1.19ex,-1ex) rectangle (1.7ex,0.6ex);
			% 	\draw (1.2ex,-0.2ex) ellipse (0.3ex and 0.7ex);
			% \end{scope}
			% \draw (0,-0.9ex) -- (1.2ex, -0.9ex);
			% \draw (0,0.5ex) -- (1.2ex, 0.5ex);
		\end{scope}
	\end{tikzpicture}%
}

\newcommand{\cylinder}{
	\begin{tikzpicture}
		\begin{scope}[line width=0.6pt]
			\draw (0,-0.2ex) ellipse (0.3ex and 0.7ex);
			\begin{scope}
				\clip (1.19ex,-1ex) rectangle (1.7ex,0.6ex);
				\draw (1.2ex,-0.2ex) ellipse (0.3ex and 0.7ex);
			\end{scope}
			\draw (0,-0.9ex) -- (1.2ex, -0.9ex);
			\draw (0,0.5ex) -- (1.2ex, 0.5ex);
		\end{scope}
	\end{tikzpicture}%
}

\newcommand{\bord}{\;\cylinderequals\,}
\newcommand{\hbord}{\;\cylinderequals^h\,}
\newcommand{\sobord}{\;\cylinderequals^{\mathrm{so}}\,}
\newcommand{\frbord}{\;\cylinderequals^{\mathrm{fr}}\,}

% \newcommand{\hbord}{
% 	\;
% 	\begin{tikzpicture}
% 		\begin{scope}[line width=0.6pt]
% 			\draw (0,0) ellipse (0.3ex and 0.7ex);
% 			\begin{scope}
% 				\clip (1.19ex,-0.9ex) rectangle (1.6ex,0.8ex);
% 				\draw (1.2ex,0) ellipse (0.3ex and 0.7ex);
% 			\end{scope}
% 			\draw (0,-0.7ex) -- (1.2ex, -0.7ex);
% 			\draw (0,0.7ex) -- (1.2ex, 0.7ex);
% 			\node[scale=0.5]  at (0.8ex,0) {$h$};
% 		\end{scope}
% 	\end{tikzpicture}%
% 	\;
% }

\renewcommand{\emptyset}{\varnothing}
\renewcommand{\cong}{\approx}

\providecommand{\Pf}{\operatorname{Pf}}

\providecommand{\w}{\operatorname{w}}

\providecommand{\ofr}{\mathfrak{o}}
\providecommand{\vfr}{\mathfrak{v}}
\providecommand{\Ufr}{\mathfrak{U}}

\providecommand{\Bun}{\operatorname{Bun}}
\providecommand{\Vect}{\operatorname{Vect}}
\providecommand{\Hdr}{\operatorname{H}_{\operatorname{dR}}}

\providecommand{\qtq}[1]{\quad\textrm{#1}\quad}

\ExplSyntaxOn
\NewDocumentCommand{\lkxto}{ O{} }{%
	\mathrel{\;\xrightarrow{\hphantom{xx}#1\hphantom{xx}}\;}
}
\NewDocumentCommand{\lkxmapsto}{ O{} }{%
	\mathrel{\;\xmapsto{\hphantom{xx}#1\hphantom{xx}}\;}
}
\NewDocumentCommand{\lkxisom}{ O{} }{%
	\mathrel{\;\xrightarrow{\hphantom{xx}#1\sim\hphantom{xx}}\;}
}
\NewDocumentCommand{\lkxsurj}{ O{} }{%
	\mathrel{\;\xtwoheadrightarrow{\hphantom{xx}#1\hphantom{xx}}\;}
}

\NewDocumentCommand{\lkxfunc}{ O{->} m m m g g }{
	\begin{array}{rcl}
		\IfNoValueTF {#5} {
			\tl_if_blank:nTF {#2}{}{#2 :}
			#3
			\str_case:nn {#1}
			{
				{->} {\lkxto}
					{~>} {\lkxisom}
					{->>} {\lkxsurj}
			}
			#4
		} {
			\tl_if_blank:nTF {#2}{}{#2 \;:\;}
			#3
		   &
			\str_case:nn {#1}
			{
				{->} {\lkxto}
					{~>} {\lkxisom}
					{->>} {\lkxsurj}
			}
		   & #4
		\\
		#5 & \lkxmapsto & #6
		}
	\end{array}
}

\ExplSyntaxOff

\usepackage{tikz-cd}
% TODO: make this like xrightarrow
\tikzcdset{arrow style=tikz, every arrow/.append style={line width=0.6pt}}
